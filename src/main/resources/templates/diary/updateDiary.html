<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="text/html; charset=UTF-8">
    <!-- 날씨 아이콘 가져오기 위한 이미지 링크 -->
    <link rel="icon" type="image/png" href="http://example.com/myicon.png">
    <!-- include libraries(jQuery, bootstrap) -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- include summernote css/js -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>

    <!-- 서머노트를 위해 추가해야할 부분 -->
    <script src="../../summernote/summernote-0.8.18-dist/summernote-lite.js"></script>
    <script src="../../summernote/summernote-0.8.18-dist/lang/summernote-ko-KR.js"></script>
    <link rel="stylesheet" href="../../summernote/summernote-0.8.18-dist/summernote-lite.css">

    <!--<link rel="stylesheet" href="/code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css"> -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="../../js/calendar/moment.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poor+Story&display=swap" rel="stylesheet">

    <title>글쓰기</title>
    <style>
        @font-face {
            font-family: 'MapoGoldenPier';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/MapoGoldenPierA.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        h2{
            font-family: 'MapoGoldenPier';
            color: #314e52;
            font-size: 70px;
        }
        #addTag, #subBtn, #shareBtn{
            font-family: 'MapoGoldenPier';
            color: #314e52;
        }
        body {
            background-color: #dbdbdb;
            text-align: center;
            position: relative;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        /* The switch - the box around the slider */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            vertical-align:middle;
        }

        #diaryTitle{
            font-family: 'MapoGoldenPier';
            border: none;
            border-bottom: 1px solid #314e52;
            display: inline-block;
            width: 100%;
            height: 43px;
            font-size: 15px;
            background: none;
            -webkit-writing-mode: horizontal-tb !important;
        }
        #diaryTitle::placeholder{
            font-family: 'MapoGoldenPier';
            color: #314e52;
        }

        #date{
            border: none;
            border-bottom: 1px solid #314e52;
            border-left: 30%;
            width: 40%;
            font-family: 'MapoGoldenPier';
            color: #314e52;
            height: 43px;
            font-size: 15px;
            background: none;
        }
        #date::placeholder{
            color: white;
        }



        #addTag{
            margin-top: 10px;
            float: right;
            margin-right: 20%;
            cursor: pointer;
            font-family: 'MapoGoldenPier';
            color: #314e52;
        }

        ol{
            position: absolute;
            top: 35%;
            right: 5%;
            padding: 0;
            margin: 0;


        }

        li{
            font-size: 0;
            margin-bottom: 10px;
        }

        .tagText{


            border: 1px solid #314e52;
            border-radius: 3px;
            height: 30px;
            font-size: 15px;
            background: none;
            width: 100%;
            font-family: "MapoGoldenPier";
            color: #314e52;
        }


        #deleteTag{
            font-size: 8px;
            font-family: "MapoGoldenPier";
            color: #314e52;
            cursor: pointer;
            margin-bottom: 10px;
        }



        .note-editor{
            width: 60%;
            margin: auto;
        }

        /* Hide default HTML checkbox */
        .switch input {display:none;}

        /* The slider */
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input.checkbox:checked + .slider {
            background-color: #2196F3;
        }

        input.checkbox:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input.checkbox:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        p.toggle {
            margin:0px;
            display:inline-block;
            font-size:15px;
            font-weight:bold;
        }

        #shareGroup{
            margin-right: 20%;
            margin-top: 10px;
            font-family: 'MapoGoldenPier';
            color: #314e52;
        }

        #subBtn{
            width: 100px;
            height: 40px;
            margin-left: 29%;
            margin-top: 30px;
            background-color: transparent;
            font-family: 'MapoGoldenPier';
            color: #314e52;
            border: 1px solid #314e52;
            border-radius: 3px;
            transition: 1s;
            -webkit-transition: 1s;
        }
        #subBtn:hover{
            width: 125px;
            height: 50px;
            margin-left: 29%;
            margin-top: 30px;
            background-color: #314e52;
            color: white;
            border: 1px solid #314e52;
            border-radius: 3px;
            font-weight: bold;
            text-decoration: underline;
        }
    </style>
    <script type="text/javascript">
        $(document).ready(function() {



            $('#summernote').summernote({
                maximumImageFileSize: 10520000,
                placeholder: 'content',
                minHeight: 370,
                maxHeight: null,
                focus: true,
                lang : 'ko-KR',
                callbacks: {
                    onImageUpload: function (files, editor, welEditable) {

                        console.log('image upload:', files);

                        // sendFile(files[0], this);
                        for(var i = files.length - 1; i>=0; i--){
                            sendFile(files[i], editor,welEditable);
                        }

                    }
                }
            });


            function sendFile(file,editor,welEditable) {
                var data = new FormData();
                data.append('file', file);
                $.ajax({
                    data: data,
                    type: "POST",
                    url: '/diary/fileUpload',
                    cache: false,
                    contentType: false,
                    enctype: 'multipart/form-data',
                    processData: false,
                    success: function(data) {
                        $("#summernote").summernote("insertImage",data.url);
                        alert(data.url);
                        console.log("console : "+data.url);
                        // $('.note-editable').append("<p><img src='"+data.url+"' width='90px' height='auto'/></p><br/>");
                        $('#summernote').summernote('insertNode', data.url);
                        // $('.note-editable').reload();
                    },
                    error:function (request,status,error, form_data){
                        alert("Error");
                    }
                });
            }


            var check = $("input[type='checkbox']");
            check.click(function(){
                $("p.toggle").toggle();
                if($("input[type='checkbox']").val()==1){
                    $("input[type='checkbox']").val(0)
                }else{
                    $("input[type='checkbox']").val(1)
                }
                console.log($("input[type='checkbox']").val());
                // $('#checkbox').is("checked").attr("value", 1);

            });

        });



        function goWrite(frm){
            var title = frm.title.value;
            var content = frm.content.value;

            if(title.trim() == ''){
                alert("제목을 입력해주세요");
                return false;
            }
            if(content.trim() == ''){
                alert("내용을 입력해주세요");
                return false;
            }
            debugger;
            $("form").attr("method", "POST").attr("action", "/diary/addDiary").submit();
        }


        $(function geoFindMe() {

            function success(position) {
                var latitude  = position.coords.latitude;
                var longitude = position.coords.longitude;
                const coordsObj = {
                    latitude,
                    longitude
                };
                var url = "https://api.openweathermap.org/data/2.5/weather?lat=" + latitude + "&lon="+ longitude + "&appid=7d9ec3e89f78fa3eef02069216cce88c&units=metric";


                //saveCoords(coordsObj);
                getWeather(latitude, longitude);

            }



            function error() {
                status.textContent = 'Unable to retrieve your location';
            }

            if(!navigator.geolocation) {
                status.textContent = 'Geolocation is not supported by your browser';
            } else {
                status.textContent = '';
                navigator.geolocation.getCurrentPosition(success, error);
            }

            function getWeather(lat, lon){
                fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=7d9ec3e89f78fa3eef02069216cce88c&units=metric`
                )
                    .then(function(response){
                        return response.json();
                    })
                    .then(function(json){
                        console.log(json);
                        const temparature = String(json.main.temp).substring(0,2);  //온도
                        const place = json.name;   // 사용자 위치
                        var icon = json.weather[0].icon;

                        $('#temparature').append(`${temparature}`)
                        $('#location').append(`${place}`)
                        $('#location1').attr("value", `${place}`)

                        $(".pic").removeClass("pic").addClass(icon);
                        var imgURL = "/images/weather/" + icon + ".png";
                        $('#img').attr("src", imgURL);
                        $('#weather').attr("value", imgURL);
                    });
            }
        });
        $("#tag").onclick(function () {
            $("#tag").prepend("<input type=\"text\" name=\"tag_text\">");
        });

    </script>



</head>
<body>
<!--<form name="writeDiary">-->
<form method="post" action="/diary/updateDiary">
    <div id="tempIcon" style="float: right; padding-left: 10px; padding-right: 10px; font-size: 20px">   &#8451;</div> &nbsp;
    <div id="temparature" style="float: right; padding-left: 20px; font-size: 20px"></div>
    <img src="" id="img" width="30px" height="30px" style="float: right; font-size: 20px"/>
    <div id="location" style="float: right; padding-left: 10px; padding-right: 20px; font-size: 20px">&#127759;          </div>

    <br><br>


    <h2 style="text-align: center; margin-top: 50px">일기 수정</h2><br><br><br>

    <input type="hidden" name="diaryId" th:value="${diary.diaryId}">
    <input type="text" id="diaryTitle" name="diaryTitle" style="width: 40%;" placeholder="제목" th:value="${diary.diaryTitle}" required/><br/>
    <input type="text" id="date" name="diaryDate"  th:value="${diary.diaryDate}" readonly /><br/>

    <span id="addTag">태그 추가 &#10133;</span><br/>

    <ol id="addedTag"></ol>
    <script>
        $(document).on("click", "#addTag", function(){
            $('#addedTag').append("<li><input class='tagText' id='tagText' type=\"text\" name=\"tag_text\" style=\"float: left\"/> <span id='deleteTag'>삭제</span></li>")
        })
        $(document).on("click", "#deleteTag", function (){
            alert($(this).closest('li'));
            $(this).closest('li').remove();
        })
    </script>

    <!--    <input type="text" name="tag_text" style="float: left">-->
    <!--    <input type="text" name="tag_text" style="float: left">-->
    <!--    <input type="text" name="tag_text" style="float: left">-->
    <!--    <input type="text" name="tag_text" style="float: left">-->
    <!--    <input type="text" name="tag_text" style="float: left">-->



    <div style="width: 100%; margin: auto;">
        <br>
        <textarea id="summernote" name="diaryText" th:text="${diary.diaryText}">
        </textarea>
        <input type="hidden" name="shareStatus" value="0">
        <span style="float: right" id="shareGroup">
            <span id="shareBtn">&#9964; 일기공유</span> &nbsp;&nbsp;

            <label class="switch">
                <input type="checkbox" name="shareStatus" class="checkbox" width="20" height="10" value=0>

                <span class="slider round"></span>
            </label>
                <p class="toggle" value="0">OFF</p>
                <p class="toggle" style="display:none;" value="1">ON</p>



            <!-- if the session(limit_start_date, user_id) is organized,
            you have to write a script(if) and append it-->
            <!-- 세션이 정리되면 limit_start_date를 세션으로 받아와서 script 조건문으로 토글 append해줘야함-->



            <!--                <label class="switch" >-->
            <!--                     <input type="checkbox" id="checkbox" onclick="toggle(this)" name="shareStatus"/>-->
            <!--                     <span class="slider round" ></span>-->
            <!--                </label>-->

        </span>
        <!--    <script>-->
        <!--        function toggle(element){-->
        <!--            console.log(element.checked);-->

        <!--        }-->


        <!--    </script>-->

        <br><br>

        <input id="subBtn" class="subBtn" type="button" value="작 성 완 료" style="text-align: center" onclick="goWrite(this.form)"/>

        <br><br><br><br>



    </div>

</form>
<link rel="stylesheet" href='../../css/main/menu.css' />
<script src="../../js/main/menu.js"></script>
<input type="checkbox" id="menuToggler" class="input-toggler" />
<label for="menuToggler" class="menu-toggler">
    <span class="menu-toggler__line"></span>
    <span class="menu-toggler__line"></span>
    <span class="menu-toggler__line"></span>
</label>
<aside class="sidebar">
    <ul class="menu">
        <li class="menu__item"><a class="menu__link" href="/user/login">Home</a></li>
        <li class="menu__item"><a class="menu__link" href="/user/getUser">Profile</a></li>
        <li class="menu__item"><a class="menu__link" href="/diary/getDiaryList">Diary</a></li>
        <li class="menu__item"><a class="menu__link" href="/calendar/mainCalendar">Calendar</a></li>
        <li class="menu__item"><a class="menu__link" href="/monologue/getMonologueList">Monologue</a></li>
        <li class="menu__item"><a class="menu__link" href="/user/logout">Logout</a></li>
    </ul>


</aside>
</body>
<script>
    function goWrite(frm) {

        var title = frm.diaryTitle.value;
        var content = frm.summernote.value;
        var tag = $("#frm input[type=text]")
        if (title.trim() == ''){
            alert("제목을 입력해주세요");
            return false;
        }$.trim($('#tagText').val())
        for(var i =0; i < tag.length; i++){
            if(""==$.trim((tag[i]).val())||null==$.trim((tag[i]).val())){
                alert("태그를 입력해주세요");
                return false;
            }

        }
        // if (tag.trim() == ''){
        //     alert("태그를 입력해주세요");
        //     return false;
        // }
        if (content.trim() == ''){
            alert("내용을 입력해주세요");
            return false;
        }else{
            frm.submit();
        }


    }

    $(function($) {
        $("body").css("display", "none");
        $("body").fadeIn(1000);
        $("a.transition").click(function(event){
            event.preventDefault();
            linkLocation = this.href;
            $("body").fadeOut(1000, redirectPage);
        });
        function redirectPage() {
            window.location = linkLocation;
        }
    });
</script>

</html>
